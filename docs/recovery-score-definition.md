# リカバリースコアの定義

## 概要

リカバリースコアは、**0-100の範囲**で、あなたの回復状態を表す指標です。

## 計算方法

リカバリースコアは以下の3つの要素から計算されます：

### 1. HRVスコア（0-40点）

**深い睡眠中のHRV平均値**を主要指標として使用します。

- **計算方法**:
  - 個人のHRVベースライン（過去30日の平均）と比較
  - ベースラインの80%以上で満点（40点）
  - ベースラインの50%以下で0点
  - その間は線形補間

- **式**: `hrv_score = min(40, max(0, (hrv_ratio - 0.5) * 80))`
  - `hrv_ratio = 深い睡眠中のHRV平均値 / HRVベースライン`

- **深い睡眠中のHRVがない場合**:
  - 夜間平均HRVを使用（代替指標）

### 2. 睡眠の質スコア（0-30点）

**深い睡眠の割合**と**総睡眠時間**から計算します。

- **深い睡眠の割合スコア（最大15点）**:
  - 深い睡眠の割合 × 30
  - 例: 深い睡眠が20%の場合 → 20% × 30 = 6点

- **睡眠時間スコア（最大15点）**:
  - 8時間で満点（15点）
  - 例: 7時間の場合 → (7 / 8) × 15 = 13.1点

- **合計**: `sleep_score = deep_score + sleep_time_score`

### 3. 安静時心拍数スコア（0-30点）

**安静時心拍数**をベースラインと比較します。

- **計算方法**:
  - 個人の安静時心拍数ベースライン（過去30日の平均）と比較
  - ベースラインの90%以下で満点（30点）
  - ベースラインより高いほどスコアが低くなる

- **式**: `hr_score = min(30, max(0, (hr_ratio - 0.9) * 100))`
  - `hr_ratio = ベースライン / 当日の安静時心拍数`

## 最終スコア

```
リカバリースコア = HRVスコア + 睡眠の質スコア + 安静時心拍数スコア
```

**範囲**: 0-100点
- **0-30点**: 回復不良（休息が必要）
- **31-50点**: 回復中（注意が必要）
- **51-70点**: 回復良好（通常の活動可能）
- **71-100点**: 回復最良（高いパフォーマンス可能）

## ベースラインの計算

ベースラインは**過去30日間のデータ**から計算されます：

- **HRVベースライン**: 過去30日の深い睡眠中のHRV平均値
- **安静時心拍数ベースライン**: 過去30日の安静時心拍数平均値

## 注意点

1. **データが不足している場合**:
   - 必要なデータ（HRV、睡眠、心拍数）がない場合は、スコアを計算できません（None）

2. **ベースラインが計算できない場合**:
   - データが30日未満の場合は、利用可能なデータからベースラインを計算

3. **個人差**:
   - スコアは個人のベースラインと比較するため、個人差が大きい
   - 絶対値ではなく、ベースラインからの乖離度を重視

## 参考

- Oura RingのReadiness Score: HRV、睡眠、活動量を組み合わせ
- GarminのRecovery Score: HRVステータスを主要指標として使用
- WhoopのRecovery Score: HRV、睡眠、心拍数を組み合わせ

